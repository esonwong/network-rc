(this["webpackJsonpfront-end"]=this["webpackJsonpfront-end"]||[]).push([[0],{201:function(e,t,a){e.exports=a(413)},206:function(e,t,a){},224:function(e,t,a){},230:function(e,t){},231:function(e,t){},232:function(e,t){},233:function(e,t){},234:function(e,t){},235:function(e,t){},413:function(e,t,a){"use strict";a.r(t);var n,r,c=a(0),i=a.n(c),o=a(9),l=a.n(o),s=(a(206),a(80)),d=a(40),u=a(41),m=a(18),p=a(55),h=a(56),f=a(170),v=a.n(f),E=a(44),g=a.n(E),w=a(423),b=a(415),y=a(421),k=a(414),x=a(426),C=a(418),S=a(65),O=a(424),j=(a(224),a(197)),I=a(14),R=a.n(I),L=a(31),z=a(89),P=a(176),F=a(422),A=a(417),T=a(416),D=a(17),N=a(427),B=a(428),_=a(429),M=a(430),U=a(431),W={labelCol:{span:6},wrapperCol:{span:16}},V={wrapperCol:{offset:6,span:16}};function G(){return H.apply(this,arguments)}function H(){return(H=Object(L.a)(R.a.mark((function e(){var t,a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.d("https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_1.0_224/model.json");case 2:return t=e.sent,a=t.getLayer("conv_pw_13_relu"),e.abrupt("return",D.e({inputs:t.inputs,outputs:a.output}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return K.apply(this,arguments)}function K(){return(K=Object(L.a)(R.a.mark((function e(t){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){navigator.vibrate&&navigator.vibrate(e)}var J=new(function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"addExample",value:function(e,t){var a=D.i((function(){return D.h(t,[1,2])}));if(null==this.xs)this.xs=D.b(e),this.ys=D.b(a);else{var n=this.xs;this.xs=D.b(n.concat(e,0));var r=this.ys;this.ys=D.b(r.concat(a,0)),n.dispose(),r.dispose(),a.dispose()}}},{key:"clean",value:function(){this.xs.dispose(),this.ys.dispose(),this.xs=null,this.ys=null}}]),e}()),Q=z.a.Option,Y=!1,$=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var i;return Object(d.a)(this,a),(i=t.call(this,e)).exampleCleanHandler=Object(L.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.setState({exampleList:[]}),J.clean();case 2:case"end":return e.stop()}}),e)}))),i.exampleHandler=function(){var e=Object(L.a)(R.a.mark((function e(t){var a,r,c,o,l,s,d,u,p,h,f;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Y=!0,a=Object(m.a)(i),r=a.state.exampleList,c=a.props,o=c.action,l=c.canvasRef,s=D.a.fromPixels(l),d=s.resizeNearestNeighbor([224,224]),u=D.i((function(){return d.expandDims(0).toFloat().div(127).sub(1)})),h=(p=t||o).speed,f=p.direction,console.log("example",p),J.addExample(n.predict(u),[h,f]),e.next=11,D.a.toPixels(d,i.smallCanvasRef.current);case 11:r.push({img:i.smallCanvasRef.current.toDataURL(),action:{speed:h,direction:f}}),i.setState({exampleList:r}),s.dispose(),Y=!1;case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.train=function(){var e=Object(L.a)(R.a.mark((function e(t){var a,c;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.setState({isTraining:!0}),console.log("Learnning Argument",t),null!=J.xs){e.next=4;break}throw new Error("Add some examples before training!");case 4:if(r=D.g({layers:[D.c.flatten({inputShape:n.outputs[0].shape.slice(1)}),D.c.dense({units:t.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),D.c.dense({units:2,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]}),a=D.j.adam(t.learnRate),r.compile({optimizer:a,loss:"meanSquaredError"}),(c=Math.floor(J.xs.shape[0]*t.batchSize))>0){e.next=10;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 10:r.fit(J.xs,J.ys,{batchSize:c,epochs:t.epochs,callbacks:{onBatchEnd:function(){var e=Object(L.a)(R.a.mark((function e(t,a){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loss: "+a.loss.toFixed(5)),i.setState({loss:a.loss.toFixed(5)});case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),onTrainEnd:function(e){i.setState({isTraining:!1})}}});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.predict=Object(L.a)(R.a.mark((function e(){var t,a,c,o;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Object(m.a)(i),a=t.props,c=a.canvasRef,(o=a.onAi)(!0),i.setState({isPredicting:!0},Object(L.a)(R.a.mark((function e(){var t,a,l,s,d,u,m,p;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.state.isPredicting){e.next=20;break}return e.next=3,q(200);case 3:return t=D.i((function(){return D.a.fromPixels(c).resizeNearestNeighbor([224,224]).expandDims(0).toFloat().div(127).sub(1)})),a=n.predict(t),l=r.predict(a),e.next=8,l.data();case 8:return s=e.sent,d=Object(j.a)(s,2),u=d[0],m=d[1],p={speed:u,direction:m},console.log("Ai \u52a8\u4f5c\uff1a",p),t.dispose(),i.doAction(p),e.next=18,D.f();case 18:e.next=0;break;case 20:o(!1);case 21:case"end":return e.stop()}}),e)}))));case 3:case"end":return e.stop()}}),e)}))),i.record=Object(L.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.setState({isRecording:!0});case 1:case"end":return e.stop()}}),e)}))),i.state={learnForm:{},exampleList:[],loading:!1,training:!1,isPredicting:!1,isRecording:!1,loss:0,learnArgument:{learnRate:.001,batchSize:.4,epochs:20,hiddenUnits:100}},i.smallCanvasRef=Object(c.createRef)(),i}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=Object(L.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,G();case 3:n=e.sent,this.setState({loading:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e,t){e.action!==this.props.action&&this.state.isRecording&&!Y&&this.exampleHandler(this.props.action)}},{key:"doAction",value:function(){var e=Object(L.a)(R.a.mark((function e(t){var a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.speed,a=t.direction,this.props.controller.direction(a);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.exampleList,n=t.loading,r=t.isRecording,c=t.isTraining,o=t.isPredicting,l=t.loss,s=t.learnArgument,d=this.exampleHandler,u=this.exampleCleanHandler,m=this.record,p=this.predict;return i.a.createElement(P.a,{spinning:n},i.a.createElement("canvas",{className:"ai-canvas",ref:this.smallCanvasRef}),i.a.createElement(b.a,Object.assign({},W,{initialValues:s,onFinish:this.train}),i.a.createElement(b.a.Item,{label:"Learning rate",name:"learnRate"},i.a.createElement(F.a,null)),i.a.createElement(b.a.Item,{label:"Batch Size",name:"batchSize"},i.a.createElement(z.a,null,i.a.createElement(Q,{value:.05},"0.05"),i.a.createElement(Q,{value:.1},"0.1"),i.a.createElement(Q,{value:.4},"0.4"),i.a.createElement(Q,{value:1},"1"))),i.a.createElement(b.a.Item,{label:"Epochs",name:"epochs"},i.a.createElement(z.a,null,i.a.createElement(Q,{value:10},"10"),i.a.createElement(Q,{value:20},"20"),i.a.createElement(Q,{value:40},"40"))),i.a.createElement(b.a.Item,{label:"Hidden units",name:"hiddenUnits"},i.a.createElement(z.a,null,i.a.createElement(Q,{value:100},"100"),i.a.createElement(Q,{value:200},"200"),i.a.createElement(Q,{value:300},"300"),i.a.createElement(Q,{value:400},"400"),i.a.createElement(Q,{value:500},"500"))),i.a.createElement(b.a.Item,{label:"loss"},i.a.createElement(F.a,{value:l})),i.a.createElement(b.a.Item,V,i.a.createElement(S.a,{type:"primary",htmlType:"submit",key:"fit",loading:c,disabled:!a.length},"\u5b66\u4e60"))),i.a.createElement(b.a,Object.assign({},W,{initialValues:{speed:0,direction:0},onFinish:function(e){return d(e)}}),i.a.createElement(b.a.Item,{name:"speed",label:"\u901f\u5ea6",required:!0},i.a.createElement(F.a,null)),i.a.createElement(b.a.Item,{name:"direction",label:"\u65b9\u5411",required:!0},i.a.createElement(F.a,null)),i.a.createElement(b.a.Item,Object.assign({},V,{className:"form-item-button"}),i.a.createElement(S.a,{key:"record-once",htmlType:"submit",type:"primary",icon:i.a.createElement(N.a,null)}),i.a.createElement(S.a,{type:"primary",icon:i.a.createElement(B.a,null),onClick:function(){return d({speed:1,direction:1})}}),i.a.createElement(S.a,{type:"primary",icon:i.a.createElement(_.a,null),onClick:function(){return d({speed:1,direction:-1})}}),i.a.createElement(S.a,{type:"primary",icon:i.a.createElement(M.a,null),onClick:function(){return d({speed:1,direction:0})}}),i.a.createElement(S.a,{type:"primary",key:"record",loading:r,onClick:m},"\u5f00\u59cb\u8bb0\u5f55"),i.a.createElement(S.a,{key:"stop",onClick:function(){e.setState({isRecording:!1})},disabled:!r},"\u505c\u6b62\u8bb0\u5f55"),i.a.createElement(S.a,{type:"danger",disabled:!a.length,onClick:u},"\u6e05\u9664")),i.a.createElement(b.a.Item,Object.assign({},V,{className:"form-item-button"}),i.a.createElement(S.a,{type:"danger",key:"predic",loading:o,onClick:p},"\u5f00\u59cb Ai \u9a7e\u9a76"),i.a.createElement(S.a,{onClick:function(){e.setState({isPredicting:!1})},disabled:!o,key:"stop"},"\u505c\u6b62 Ai \u9a7e\u9a76"))),i.a.createElement(A.a,{size:"small",className:"ai-example-list",grid:{gutter:16,column:4},itemLayout:"vertical",pagination:{pageSize:12},dataSource:a,renderItem:function(e){var t=e.img,a=e.action,n=a.speed,r=a.direction;return i.a.createElement(A.a.Item,null,i.a.createElement(T.a,{size:"small",title:"\u901f\u5ea6\uff1a".concat(n,"    \u65b9\u5411\uff1a").concat(r),actions:[i.a.createElement(S.a,{size:"small",icon:i.a.createElement(U.a,null),type:"danger"})]},i.a.createElement("img",{style:{maxWidth:"100%"},src:t,alt:"example"})))}}))}}]),a}(c.Component),X=a(60),ee=a(420),te=a(432),ae=a(433),ne=a(434),re=a(435),ce=a(425),ie=Object(ce.a)({scriptUrl:"//at.alicdn.com/t/font_1773709_52px07fzrwt.js"});function oe(e){return i.a.createElement(ee.a,Object.assign({mode:"horizontal"},e),i.a.createElement(ee.a.Item,null,i.a.createElement(X.a,{to:"".concat("/network-rc","/setting")},i.a.createElement(te.a,null)," \u8bbe\u7f6e")),i.a.createElement(ee.a.Item,null,i.a.createElement("a",{href:"https://space.bilibili.com/96740361",target:"_blank",rel:"noopener noreferrer"},i.a.createElement(ie,{type:"icon-bilibili-fill"})," B\u7ad9 EsonWong")),i.a.createElement(ee.a.Item,null,i.a.createElement("a",{href:"https://www.youtube.com/channel/UCyQR6LHhhhpTFfxZo7VZddA",target:"_blank",rel:"noopener noreferrer"},i.a.createElement(ae.a,null)," Youtube EsonWong")),i.a.createElement(ee.a.Item,null,i.a.createElement("a",{href:"https://github.com/itiwll/network-rc",target:"_blank",rel:"noopener noreferrer"},i.a.createElement(ne.a,null)," Github Network-rc")),i.a.createElement(ee.a.Item,null,i.a.createElement("a",{href:"https://weibo.com/u/5034944416",target:"_blank",rel:"noopener noreferrer"},i.a.createElement(re.a,null)," \u5fae\u535a Eson_Wong")))}var le,se=a(437),de=a(442),ue=a(436),me=a(438),pe=a(439),he=a(440),fe=a(441),ve=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).handleKeyDown=function(e){var t=Object(m.a)(n).props,a=t.controller,r=a.speed,c=a.direction,i=t.onControl,o=e.key;"w"===o&&r(1),"s"===o&&r(-1),"a"===o&&c(1),"d"===o&&c(-1),i&&i()},n.handleKeyUp=function(e){var t=Object(m.a)(n).props,a=t.controller,r=a.speed,c=a.direction,i=t.onControl,o=e.key;"w"===o&&r(0),"s"===o&&r(0),"a"===o&&c(0),"d"===o&&c(0),i&&i()},n.keyboardBind=function(){var e=Object(m.a)(n),t=e.handleKeyDown,a=e.handleKeyUp;window.document.addEventListener("keydown",t,!1),window.document.addEventListener("keyup",a,!1)},n.ref=Object(c.createRef)(),n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.keyboardBind()}},{key:"componentWillUnmount",value:function(){var e=this.handleKeyDown,t=this.handleKeyUp;window.document.removeEventListener("keydown",e,!1),window.document.removeEventListener("keyup",t,!1)}},{key:"render",value:function(){return i.a.createElement("div",null)}}]),a}(c.Component),Ee=a(185),ge=a.n(Ee),we=!1;window.addEventListener("deviceorientation",(function(e){var t=e.alpha,a=e.beta,n=e.gamma;le={alpha:t,beta:a,gamma:n},(t||we)&&(we=!0)}));var be=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,e)).gamepadConnected=function(e){var t=e.gamepad,a=t.index,r=t.id;w.a.success("\u63a7\u5236\u5668\u5df2\u8fde\u63a5\u4e8e ".concat(a," \u4f4d: ").concat(r,"\u3002")),n.setState({gamepadEnabled:!0})},n.gamepadPress=function(e){var t=e.detail,a=t.index,r=t.value,c=n.props,i=c.lightEnabled,o=c.cameraEnabled,l=c.controller,s=l.changeLight,d=l.changeCamera,u=n.state.forwardPower,p=Object(m.a)(n).fixedController,h=p.speed,f=p.direction;1!==a&&13!==a&&6!==a||h(-1*r),0!==a&&12!==a&&7!==a||h(r),14===a&&f(-1*r),15===a&&f(r),9===a&&1===r&&s(!i),16===a&&1===r&&d(!o),4!==a&&2!==a||1!==r||((u-=5)<0&&(u=0),n.setState({forwardPower:u})),3!==a&&5!==a||1!==r||((u+=5)>100&&(u=100),n.setState({forwardPower:u}))},n.gamepadAxis=function(e){var t=e.detail,a=t.index,r=t.value,c=Object(m.a)(n).fixedController,i=c.speed,o=c.direction;0===a&&o(-r),3===a&&i(-r)},n.gamePadsLoop=function(){var e={},t={};n.gamePadsTime=setInterval((function(){for(var a=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],n=function(n){var r=a[n];if(!r)return"continue";var c=r.axes,i=r.buttons;if(!r.connected)return"continue";i.forEach((function(t,a){e["".concat(n,"-").concat(a)]?(e["".concat(n,"-").concat(a)].value!==t.value&&window.dispatchEvent(new CustomEvent("gamepadpress",{detail:{index:a,value:t.value}})),e["".concat(n,"-").concat(a)]=t):e["".concat(n,"-").concat(a)]=t})),c.forEach((function(e,a){t["".concat(n,"-").concat(a)]?(t["".concat(n,"-").concat(a)].value!==e&&window.dispatchEvent(new CustomEvent("gamepadaxis",{detail:{index:a,value:e}})),t["".concat(n,"-").concat(a)]={value:e}):t["".concat(n,"-").concat(a)]={value:e}}))},r=0;r<a.length;r++)n(r)}),50)},n.deviceorientation=function(e){e.alpha;var t=e.beta,a=(e.gamma,Object(m.a)(n)),r=a.props.controller,c=a.state,i=c.directionReverse,o=c.isAiControlling,l=c.zeroOrientation;if(l&&!o){var s=t-l.beta;s=(s=s<-30?-30:s)>30?30:s,r.direction(s/30*(i?-1:1))}},n.fixedController={speed:function(e){var t=Object(m.a)(n),a=t.props.controller.speed,r=t.state,c=r.forwardPower,i=r.backwardPower;a(e*(r.speedReverse?-1:1)*((e>0?c:i)/100))},direction:function(e){var t=Object(m.a)(n),a=t.props.controller.direction,r=t.state;a(e*(r.directionReverse?-1:1)+r.directionFix)}},n.fixContent=function(){var e=n.state,t=e.directionReverse,a=e.speedReverse,r=e.directionFix;return i.a.createElement(b.a,null,i.a.createElement(b.a.Item,{style:{display:we?void 0:"none"}},i.a.createElement(S.a,{type:"danger",onClick:function(){n.setState({zeroOrientation:Object(s.a)({},le)})},icon:i.a.createElement(ue.a,null)},"\u8235\u673a\u611f\u5e94\u6821\u51c6")),i.a.createElement(b.a.Item,{label:"\u8235\u673a\u53cd\u5411"},i.a.createElement(k.a,{checked:t,onChange:function(e){n.setState({directionReverse:e}),g.a.set("directionReverse",e)}})),i.a.createElement(b.a.Item,{label:"\u6cb9\u95e8\u53cd\u5411"},i.a.createElement(k.a,{checked:a,onChange:function(e){n.setState({speedReverse:e}),g.a.set("speedReverse",e)}})),i.a.createElement(b.a.Item,{label:"\u8235\u673a\u5fae\u8c03"},i.a.createElement(C.a,{value:50*r+50,min:0,max:100,included:!1,onChange:function(e){var t=e/50-1;g.a.set("directionFix",t),n.setState({directionFix:t},(function(){n.fixedController.direction(0)}))},style:{width:"50vw"}})))},n.state={zeroOrientation:void 0,directionReverse:g.a.get("directionReverse")||!1,speedReverse:g.a.get("speedReverse")||!1,backwardPower:50,forwardPower:50,directionFix:g.a.get("directionFix")||0,isShowButton:ge()(),gamepadEnabled:!1},n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("deviceorientation",this.deviceorientation),window.addEventListener("gamepadconnected",this.gamepadConnected),window.addEventListener("gamepaddisconnected",this.gamepadDisconnected),window.addEventListener("gamepadpress",this.gamepadPress),window.addEventListener("gamepadaxis",this.gamepadAxis),this.gamePadsLoop()}},{key:"componentWillUnmount",value:function(){clearInterval(this.gamePadsTime),window.removeEventListener("deviceorientation",this.deviceorientation),window.removeEventListener("gamepadconnected",this.gamepadConnected),window.removeEventListener("gamepaddisconnected",this.gamepadDisconnected),window.removeEventListener("gamepadpress",this.gamepadPress),window.removeEventListener("gamepadaxis",this.gamepadAxis),window.removeEventListener("deviceorientation",this.handleSetZeroOrientation)}},{key:"gamepadDisconnected",value:function(e){var t=e.gamepad,a=t.index,n=t.id;w.a.error("\u63a7\u5236\u5668\u4f4d".concat(n,"-").concat(a,"\u5df2\u65ad\u5f00\u3002"))}},{key:"render",value:function(){var e=this,t=this.fixContent,a=this.fixedController,n=a.speed,r=a.direction,o=this.state,l=o.gamepadEnabled,s=o.forwardPower,d=o.backwardPower,u=o.isShowButton;return i.a.createElement("div",{className:"controller"},i.a.createElement(b.a,{className:"controller-form",size:"small",layout:"inline"},i.a.createElement(b.a.Item,null,i.a.createElement(x.a,{content:t,title:"\u4fee\u6b63",trigger:"click"},i.a.createElement(S.a,{icon:i.a.createElement(se.a,null)},"\u4fee\u6b63"))),u&&i.a.createElement(c.Fragment,null,i.a.createElement(S.a,{className:"left-button",shape:"circle",size:"large",type:"primary",onTouchStart:function(){r(1),Z(50)},onTouchEnd:function(){r(0)},icon:i.a.createElement(me.a,null),style:{display:we?"none":void 0}}),i.a.createElement(S.a,{className:"right-button",shape:"circle",size:"large",type:"primary",onTouchStart:function(){r(-1),Z(50)},onTouchEnd:function(){r(0)},icon:i.a.createElement(pe.a,null),style:{display:we?"none":void 0}}),i.a.createElement(S.a,{className:"forward-button",shape:"circle",size:"large",type:"primary",onTouchStart:function(){n(1),Z(300)},onTouchEnd:function(){n(0)},icon:i.a.createElement(he.a,null)}),i.a.createElement(S.a,{className:"backward-button",shape:"circle",size:"large",type:"primary",onTouchStart:function(){n(-1),Z([100,50,100])},onTouchEnd:function(){n(0)},icon:i.a.createElement(fe.a,null)})),i.a.createElement(b.a.Item,null,i.a.createElement(x.a,{placement:"topLeft",content:i.a.createElement(C.a,{value:s,min:0,max:100,onChange:function(t){e.setState({forwardPower:t})},arrowPointAtCenter:!0,style:{width:"30vw"}})},i.a.createElement(S.a,{shape:"round"},"\u524d\u8fdb\u6cb9\u95e8:",s))),i.a.createElement(b.a.Item,null,i.a.createElement(x.a,{placement:"topLeft",content:i.a.createElement(C.a,{value:d,min:0,max:100,style:{width:"30vw"},onChange:function(t){e.setState({backwardPower:t})}})},i.a.createElement(S.a,{shape:"round"},"\u5012\u9000\u6cb9\u95e8:",d))),i.a.createElement(b.a.Item,null,i.a.createElement(k.a,{checked:u,onChange:function(t){return e.setState({isShowButton:t})},checkedChildren:i.a.createElement(de.a,null),unCheckedChildren:i.a.createElement(de.a,null)})),i.a.createElement(b.a.Item,null,i.a.createElement(k.a,{checked:l,onChange:function(t){t?e.gamePadsLoop():clearInterval(e.gamePadsTime),e.setState({gamepadEnabled:t})},unCheckedChildren:i.a.createElement(ie,{type:"icon-game-"}),checkedChildren:i.a.createElement(ie,{type:"icon-game-"})})),i.a.createElement(b.a.Item,null," ",i.a.createElement(O.a,null,"\u952e\u76d8:wsad"))),i.a.createElement(ve,{controller:{speed:n,direction:r}}))}}]),a}(c.Component),ye=a(200),ke=a(419),xe=z.a.Option;function Ce(e){e.onDisconnect,e.wsConnected;var t=e.onSubmit,a=e.serverSetting,n=Object(ye.a)(e,["onDisconnect","wsConnected","onSubmit","serverSetting"]);return i.a.createElement(b.a,Object.assign({},W,{onFinish:t,initialValues:n}),i.a.createElement("br",null),i.a.createElement(b.a.Item,{label:"\u8fde\u63a5\u5730\u5740",name:"wsAddress",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8fde\u63a5\u5730\u5740!"}]},i.a.createElement(ke.a,null)),i.a.createElement(b.a.Item,{label:"\u6700\u5927\u901f\u5ea6",name:"speedMax"},i.a.createElement(C.a,{min:0,max:a.maxSpeed,tooltipVisible:!0})),i.a.createElement(b.a.Item,{label:"\u6444\u50cf\u5934\u6a21\u5f0f",name:"cameraMode"},i.a.createElement(z.a,null,i.a.createElement(xe,{value:"default"},"300p-30fps(\u9ed8\u8ba4)"),i.a.createElement(xe,{value:"480p-15fps"},"480p-15fps"),i.a.createElement(xe,{value:"600p"},"600p-30fps"))),i.a.createElement(b.a.Item,V,i.a.createElement(S.a,{type:"primary",htmlType:"submit"},"\u4fdd\u5b58")))}var Se=a(192),Oe=a.n(Se),je=a(443),Ie=a(444),Re=a(445),Le=a(446),ze=a(447),Pe=a(448),Fe=a(449);function Ae(e){var t=e.onSubmit;return i.a.createElement(b.a,Object.assign({},W,{onFinish:t}),i.a.createElement(b.a.Item,{label:"\u5bc6\u7801",name:"password"},i.a.createElement(ke.a,{type:"password"})),i.a.createElement(b.a.Item,V,i.a.createElement(S.a,{type:"primary",htmlType:"submit"},"\u767b\u5f55")))}var Te=a(193),De=a.n(Te),Ne=a(194),Be=a.n(Ne),_e=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var n;Object(d.a)(this,a),(n=t.call(this,e)).connect=function(){var e=n.state.setting.wsAddress;n.wsavc.connect("".concat("https:"===window.location.protocol?"wss://":"ws://").concat(e))},n.disconnect=function(e){e&&e.preventDefault(),n.setState({wsConnected:!1}),n.wsavc&&n.wsavc.disconnect()},n.login=function(e){var t=e.password;n.state.wsConnected&&n.wsavc.send("login",{token:De()("".concat(t,"eson"))})},n.changeCamera=function(e){var t=Object(m.a)(n).state,a=t.setting.cameraMode;t.wsConnected&&n.wsavc.send("open camera",{enabled:e,cameraMode:a})},n.changeLight=function(e){n.state.wsConnected&&n.wsavc.send("open light",e)},n.changeSetting=function(e){n.setState({setting:e}),g.a.set("setting",e),Object(X.d)("".concat("/network-rc","/"))},n.changeZeroSpeedRate=function(e){n.state.wsConnected&&(n.wsavc.send("speed zero rate",e),n.setState({speedZeroRate:e}))},n.changeSpeed=function(e){n.state.wsConnected&&n.wsavc.send("speed rate",e)},n.changeDirection=function(e){n.state.wsConnected&&n.wsavc.send("direction rate",e)},n.appRef=Object(c.createRef)(),n.playerBoxRef=Object(c.createRef)(),n.state={setting:Object(s.a)({speedMax:20,wsAddress:window.location.host,cameraMode:"default"},g.a.get("setting")),serverSetting:{maxSpeed:100},wsConnected:!1,cameraEnabled:!1,lightEnabled:!1,canvasRef:void 0,isAiControlling:!1,isFullscreen:!1,videoSize:50,delay:void 0,action:{speed:0,direction:0}};var r=Object(m.a)(n),i=r.changeCamera,o=r.changeLight;return n.controller={changeLight:o,changeCamera:i,speed:function(e){var t=Object(m.a)(n),a=t.changeSpeed,r=t.state,c=r.setting.speedMax,i=r.action;i.speed=e*c/100,n.setState({action:Object(s.a)({},i)}),a(i.speed)},direction:function(e){var t=Object(m.a)(n),a=t.changeDirection,r=t.state.action;r.direction=e,a(e),n.setState({action:Object(s.a)({},r)})}},n.changeVideoSize=Be()((function(){n.setState({unbounceVideoSize:n.state})}),300),n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e,t=this,a=this.connect;this.wsavc=new Oe.a({useWorker:!0}),this.wsavc.on("pong",(function(e){var a=e.sendTime;t.setState({delay:((new Date).getTime()-a)/2})})),this.wsavc.on("controller init",(function(e){var a=e.needPassword,n=e.maxSpeed;t.setState({serverSetting:{maxSpeed:n,needPassword:a}}),a&&Object(X.d)("".concat("/network-rc","/login"))})),this.wsavc.on("disconnected",(function(){console.log("WS disconnected"),t.setState({wsConnected:!1,cameraEnabled:!1}),clearInterval(e)})),this.wsavc.on("connected",(function(){console.log("WS connected"),t.setState({wsConnected:!0}),e=setInterval((function(){var e=(new Date).getTime();t.wsavc.send("ping",{sendTime:e})}),1e3)})),this.wsavc.on("frame_shift",(function(e){})),this.wsavc.on("resized",(function(e){console.log("resized",e)})),this.wsavc.on("stream_active",(function(e){console.log("Stream is ",e?"active":"offline"),e&&t.playerBoxRef.current.appendChild(t.wsavc.AvcPlayer.canvas),t.setState({cameraEnabled:e})})),this.wsavc.on("light enabled",(function(e){t.setState({lightEnabled:e})})),this.wsavc.on("login",(function(e){var t=e.message;w.a.success(t),Object(X.d)("".concat("/network-rc","/"))})),this.wsavc.on("error",(function(e){var t=e.message;w.a.error(t)})),a(),document.body.addEventListener("fullscreenchange",(function(){document.fullscreenElement?t.setState({isFullscreen:!0}):t.setState({isFullscreen:!1})}))}},{key:"render",value:function(){var e=this,t=this.disconnect,a=this.connect,n=this.controller,r=this.changeSetting,c=this.changeLight,o=this.changeCamera,l=this.login,s=this.state,d=s.setting,u=s.wsConnected,m=s.cameraEnabled,p=s.canvasRef,h=s.action,f=s.isFullscreen,E=s.serverSetting,g=s.lightEnabled,w=s.videoSize,j=s.delay;return i.a.createElement("div",{className:"App",ref:this.appRef},i.a.createElement(b.a,{layout:"inline",className:"app-status",size:"small"},i.a.createElement(b.a.Item,null,i.a.createElement(X.b,null,(function(e){var t=e.navigate;return i.a.createElement(y.a.Button,{overlay:oe,onClick:function(){return t("".concat("/network-rc","/"))},type:"primary"},i.a.createElement(je.a,null)," \u63a7\u5236")}))),i.a.createElement(b.a.Item,null,i.a.createElement(k.a,{checked:u,onChange:function(e){e?a():t()},unCheckedChildren:i.a.createElement(Ie.a,null),checkedChildren:i.a.createElement(Ie.a,null)})),i.a.createElement(b.a.Item,null,i.a.createElement(k.a,{checked:m,onChange:o,checkedChildren:i.a.createElement(Re.a,null),unCheckedChildren:i.a.createElement(Re.a,null)})),m&&i.a.createElement(b.a.Item,null,i.a.createElement(x.a,{placement:"bottomRight",content:i.a.createElement(C.a,{defaultValue:w,step:.1,tipFormatter:function(e){return 2*e},onAfterChange:function(t){return e.setState({videoSize:t})},style:{width:"30vw"},marks:{0:0,50:100,100:200}})},i.a.createElement(S.a,{shape:"round"},i.a.createElement(Le.a,null),(2*w).toFixed(1),"%"))),i.a.createElement(b.a.Item,null,i.a.createElement(k.a,{checked:g,onChange:c,checkedChildren:i.a.createElement(ze.a,null),unCheckedChildren:i.a.createElement(ze.a,null)})),document.body.requestFullscreen&&i.a.createElement(b.a.Item,null,i.a.createElement(S.a,{type:"primary",shape:"circle",icon:f?i.a.createElement(Pe.a,null):i.a.createElement(Fe.a,null),onClick:function(){f?document.exitFullscreen():document.body.requestFullscreen()}})),u&&j&&i.a.createElement(b.a.Item,null,i.a.createElement(O.a,{color:j>80?"red":"green"},"ping:",j))),i.a.createElement(X.c,{className:"app-page"},i.a.createElement(be,{path:"".concat("/network-rc","/"),controller:n,lightEnabled:g,cameraEnabled:m}),i.a.createElement(Ce,Object.assign({path:"".concat("/network-rc","/setting")},d,{serverSetting:E,wsConnected:u,onDisconnect:t,onSubmit:r})),i.a.createElement(Ae,{path:"".concat("/network-rc","/login"),onSubmit:l}),i.a.createElement($,{path:"".concat("/network-rc","/ai"),canvasRef:p,action:h,controller:n,onAi:function(t){return e.setState({isAiControlling:t})}})),i.a.createElement("div",{className:"player-box",ref:this.playerBoxRef,style:{opacity:m?1:0,transform:"scale(".concat(w/50,")")}}),i.a.createElement(v.a,{preventSleep:u}))}}]),a}(c.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(_e,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[201,1,2]]]);
//# sourceMappingURL=main.032d15a8.chunk.js.map